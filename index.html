<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Projects Center</title>
<link href="https://fonts.googleapis.com/css2?family=Cabinet+Grotesk:wght@300;400;500;600;700;800;900&family=Instrument+Serif:ital@0;1&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   THEME TOKENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
[data-theme="light"] {
  --bg:           #F7F6F2;
  --bg2:          #EEECEA;
  --bg3:          #E5E3DE;
  --surface:      #FFFFFF;
  --surface2:     #FAFAF8;
  --border:       #E2DFD8;
  --border2:      #CCCAC4;
  --text:         #1C1B18;
  --text2:        #6B6860;
  --text3:        #AAA89F;
  --shadow:       0 1px 3px rgba(0,0,0,0.06), 0 6px 20px rgba(0,0,0,0.05);
  --shadow-lg:    0 8px 40px rgba(0,0,0,0.12);
  --sidebar-bg:   #1C1B18;
  --sidebar-text: #F0EEE8;
  --sidebar-t2:   #888580;
  --sidebar-t3:   #555350;
  --sidebar-hover:rgba(255,255,255,0.06);
  --sidebar-active:rgba(255,255,255,0.10);
  --sidebar-border:rgba(255,255,255,0.08);
}
[data-theme="dark"] {
  --bg:           #0F0F0D;
  --bg2:          #161613;
  --bg3:          #1E1E1A;
  --surface:      #1A1A17;
  --surface2:     #202020;
  --border:       #2A2A26;
  --border2:      #363632;
  --text:         #F0EEE8;
  --text2:        #888580;
  --text3:        #4A4A45;
  --shadow:       0 1px 3px rgba(0,0,0,0.3), 0 6px 20px rgba(0,0,0,0.2);
  --shadow-lg:    0 8px 40px rgba(0,0,0,0.5);
  --sidebar-bg:   #111110;
  --sidebar-text: #F0EEE8;
  --sidebar-t2:   #666360;
  --sidebar-t3:   #3A3A36;
  --sidebar-hover:rgba(255,255,255,0.04);
  --sidebar-active:rgba(255,255,255,0.08);
  --sidebar-border:rgba(255,255,255,0.06);
}
:root {
  --blue:       #2563EB;
  --blue-lt:    rgba(37,99,235,0.12);
  --blue-lt2:   rgba(37,99,235,0.06);
  --green:      #16A34A;
  --green-lt:   rgba(22,163,74,0.12);
  --amber:      #D97706;
  --amber-lt:   rgba(217,119,6,0.12);
  --red:        #DC2626;
  --red-lt:     rgba(220,38,38,0.10);
  --purple:     #7C3AED;
  --purple-lt:  rgba(124,58,237,0.12);
  --teal:       #0891B2;
  --teal-lt:    rgba(8,145,178,0.12);
  --telegram:   #229ED9;
  --telegram-lt:rgba(34,158,217,0.12);
  --font:       'Cabinet Grotesk', sans-serif;
  --serif:      'Instrument Serif', serif;
  --mono:       'JetBrains Mono', monospace;
  --r:          12px;
  --r-sm:       8px;
  --r-lg:       18px;
}
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; overflow: hidden; }
body {
  font-family: var(--font);
  background: var(--bg);
  color: var(--text);
  -webkit-font-smoothing: antialiased;
  transition: background 0.3s, color 0.3s;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.app {
  display: grid;
  grid-template-columns: 260px 1fr;
  height: 100vh;
  overflow: hidden;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SIDEBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sidebar {
  background: var(--sidebar-bg);
  display: flex;
  flex-direction: column;
  height: 100vh;
  overflow: hidden;
  transition: background 0.3s;
  position: relative;
}
.sidebar::before {
  content: '';
  position: absolute;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
}
.logo-area {
  padding: 22px 20px 18px;
  border-bottom: 1px solid var(--sidebar-border);
  position: relative;
  z-index: 1;
  flex-shrink: 0;
}
.logo-row { display: flex; align-items: center; gap: 12px; }
.logo-mark { width: 40px; height: 40px; flex-shrink: 0; position: relative; }
.logo-mark svg { width: 40px; height: 40px; }
.logo-text-wrap { flex: 1; min-width: 0; }
.logo-name { font-size: 15px; font-weight: 800; color: var(--sidebar-text); letter-spacing: -0.3px; line-height: 1.1; white-space: nowrap; }
.logo-tagline { font-family: var(--mono); font-size: 9px; color: var(--sidebar-t2); letter-spacing: 1.5px; text-transform: uppercase; margin-top: 2px; }
.github-badge {
  display: flex; align-items: center; gap: 6px;
  margin-top: 10px;
  padding: 5px 9px;
  background: rgba(255,255,255,0.06);
  border: 1px solid var(--sidebar-border);
  border-radius: 6px;
  font-family: var(--mono);
  font-size: 10px;
  color: var(--sidebar-t2);
  cursor: pointer;
  transition: all 0.15s;
}
.github-badge:hover { background: rgba(255,255,255,0.1); color: var(--sidebar-text); }
.github-dot { width: 6px; height: 6px; border-radius: 50%; background: #22c55e; flex-shrink: 0; }
.github-dot.offline { background: var(--sidebar-t3); }

.sidebar-body { flex: 1; overflow-y: auto; padding: 16px 12px; position: relative; z-index: 1; }
.sidebar-body::-webkit-scrollbar { width: 0; }
.nav-section { margin-bottom: 22px; }
.nav-section-label { font-family: var(--mono); font-size: 9px; letter-spacing: 2px; color: var(--sidebar-t3); text-transform: uppercase; padding: 0 10px; margin-bottom: 4px; }
.nav-item {
  display: flex; align-items: center; gap: 10px;
  padding: 9px 10px; border-radius: var(--r-sm); cursor: pointer;
  transition: background 0.15s; color: var(--sidebar-t2); font-size: 13.5px; font-weight: 500;
  margin-bottom: 1px; border: none; background: none; width: 100%; text-align: left; position: relative;
}
.nav-item:hover { background: var(--sidebar-hover); color: var(--sidebar-text); }
.nav-item.active { background: var(--sidebar-active); color: var(--sidebar-text); }
.nav-item.active::before {
  content: ''; position: absolute; left: 0; top: 50%; transform: translateY(-50%);
  width: 3px; height: 18px; background: var(--blue); border-radius: 0 3px 3px 0;
}
.nav-icon { width: 28px; height: 28px; border-radius: 7px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; background: rgba(255,255,255,0.05); }
.nav-item.active .nav-icon { background: rgba(37,99,235,0.25); }
.nav-label { flex: 1; }
.nav-badge { font-family: var(--mono); font-size: 10px; padding: 2px 6px; border-radius: 20px; background: rgba(255,255,255,0.08); color: var(--sidebar-t2); min-width: 20px; text-align: center; }
.nav-badge.accent { background: var(--blue); color: white; }
.nav-badge.danger { background: var(--red); color: white; }

.project-list-item {
  display: flex; align-items: center; gap: 9px; padding: 8px 10px;
  border-radius: var(--r-sm); cursor: pointer; transition: background 0.15s;
  margin-bottom: 1px; border: none; background: none; width: 100%; text-align: left;
}
.project-list-item:hover { background: var(--sidebar-hover); }
.project-list-item.active { background: var(--sidebar-active); }
.pli-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.pli-name { font-size: 13px; font-weight: 500; color: var(--sidebar-t2); flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.project-list-item.active .pli-name { color: var(--sidebar-text); }
.pli-pct { font-family: var(--mono); font-size: 10px; color: var(--sidebar-t3); flex-shrink: 0; }
.project-list-item.active .pli-pct { color: var(--sidebar-t2); }
.pli-tg { font-size: 10px; opacity: 0.6; flex-shrink: 0; }

.sidebar-add {
  width: 100%; display: flex; align-items: center; gap: 8px; padding: 8px 10px;
  border-radius: var(--r-sm); background: none; border: 1px dashed var(--sidebar-t3);
  color: var(--sidebar-t3); font-family: var(--font); font-size: 13px; cursor: pointer;
  transition: all 0.15s; margin-top: 6px;
}
.sidebar-add:hover { border-color: var(--blue); color: #6EA8FE; background: rgba(37,99,235,0.08); }

.sidebar-foot { padding: 14px 12px; border-top: 1px solid var(--sidebar-border); position: relative; z-index: 1; flex-shrink: 0; display: flex; flex-direction: column; gap: 4px; }
.theme-toggle {
  display: flex; align-items: center; gap: 10px; padding: 9px 10px;
  border-radius: var(--r-sm); cursor: pointer; transition: background 0.15s;
  color: var(--sidebar-t2); font-size: 13px; font-weight: 500; border: none; background: none; width: 100%;
}
.theme-toggle:hover { background: var(--sidebar-hover); color: var(--sidebar-text); }
.theme-pill { margin-left: auto; width: 36px; height: 20px; background: rgba(255,255,255,0.1); border-radius: 20px; position: relative; transition: background 0.2s; }
.theme-pill::after { content: ''; position: absolute; top: 3px; left: 3px; width: 14px; height: 14px; border-radius: 50%; background: #888; transition: all 0.25s cubic-bezier(0.34,1.56,0.64,1); }
[data-theme="dark"] .theme-pill { background: rgba(37,99,235,0.4); }
[data-theme="dark"] .theme-pill::after { left: 19px; background: white; }
.export-btn {
  display: flex; align-items: center; gap: 8px; padding: 8px 10px;
  border-radius: var(--r-sm); cursor: pointer; transition: background 0.15s;
  color: var(--sidebar-t2); font-size: 12px; font-weight: 500; border: none; background: none; width: 100%;
}
.export-btn:hover { background: var(--sidebar-hover); color: var(--sidebar-text); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAIN AREA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.main { display: flex; flex-direction: column; height: 100vh; overflow: hidden; background: var(--bg); transition: background 0.3s; }
.topbar {
  height: 58px; display: flex; align-items: center; padding: 0 28px; gap: 12px;
  background: var(--surface); border-bottom: 1px solid var(--border); flex-shrink: 0;
  transition: background 0.3s, border-color 0.3s;
}
.topbar-title { font-size: 15px; font-weight: 700; letter-spacing: -0.2px; }
.topbar-divider { width: 1px; height: 18px; background: var(--border); flex-shrink: 0; }
.topbar-crumb { font-size: 13px; color: var(--text2); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 200px; }
.topbar-space { flex: 1; }

.view-tabs { display: flex; background: var(--bg2); border: 1px solid var(--border); border-radius: var(--r-sm); padding: 3px; gap: 2px; }
.view-tab { padding: 5px 14px; border-radius: 6px; font-size: 12px; font-weight: 600; cursor: pointer; color: var(--text2); transition: all 0.15s; border: none; background: none; font-family: var(--font); white-space: nowrap; }
.view-tab.active { background: var(--surface); color: var(--text); box-shadow: 0 1px 3px rgba(0,0,0,0.08); }

.btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 15px; border-radius: var(--r-sm); font-family: var(--font); font-size: 13px; font-weight: 600; cursor: pointer; border: none; outline: none; transition: all 0.15s; white-space: nowrap; }
.btn-primary { background: var(--blue); color: white; }
.btn-primary:hover { background: #1D4ED8; box-shadow: 0 4px 12px rgba(37,99,235,0.35); transform: translateY(-1px); }
.btn-ghost { background: var(--bg2); color: var(--text2); border: 1px solid var(--border); }
.btn-ghost:hover { background: var(--bg3); color: var(--text); }
.btn-danger { background: var(--red-lt); color: var(--red); border: 1px solid rgba(220,38,38,0.2); }
.btn-danger:hover { background: rgba(220,38,38,0.18); }
.btn-telegram { background: var(--telegram-lt); color: var(--telegram); border: 1px solid rgba(34,158,217,0.25); }
.btn-telegram:hover { background: rgba(34,158,217,0.2); }
.btn-sm { padding: 6px 11px; font-size: 12px; border-radius: 7px; gap: 5px; }
.btn-icon { width: 34px; height: 34px; padding: 0; border-radius: var(--r-sm); display: flex; align-items: center; justify-content: center; font-size: 15px; background: var(--bg2); color: var(--text2); border: 1px solid var(--border); }
.btn-icon:hover { background: var(--bg3); color: var(--text); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONTENT AREA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.content { flex: 1; overflow-y: auto; padding: 28px; transition: background 0.3s; }
.content::-webkit-scrollbar { width: 4px; }
.content::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DASHBOARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.dash-hero {
  background: var(--surface); border: 1px solid var(--border); border-radius: var(--r-lg);
  padding: 28px 32px; margin-bottom: 24px; position: relative; overflow: hidden; box-shadow: var(--shadow);
}
.dash-hero::before { content: ''; position: absolute; top: -60px; right: -60px; width: 240px; height: 240px; background: radial-gradient(circle, rgba(37,99,235,0.08) 0%, transparent 70%); pointer-events: none; }
.dash-greeting { font-family: var(--serif); font-size: 28px; font-style: italic; color: var(--text); margin-bottom: 4px; }
.dash-greeting strong { font-style: normal; font-family: var(--font); font-weight: 800; }
.dash-sub { font-size: 14px; color: var(--text2); margin-bottom: 24px; }
.dash-kpis { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }
.kpi { background: var(--bg); border: 1px solid var(--border); border-radius: var(--r); padding: 16px 18px; transition: border-color 0.15s; }
.kpi:hover { border-color: var(--border2); }
.kpi-label { font-family: var(--mono); font-size: 10px; color: var(--text3); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 8px; }
.kpi-value { font-size: 28px; font-weight: 800; letter-spacing: -1px; line-height: 1; margin-bottom: 4px; }
.kpi-delta { font-size: 12px; color: var(--text3); }
.kpi-delta b { color: var(--green); }

.section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
.section-title { font-size: 15px; font-weight: 700; }
.section-meta { font-size: 12px; color: var(--text3); font-family: var(--mono); }

.project-cards { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 16px; }
.pcard {
  background: var(--surface); border: 1px solid var(--border); border-radius: var(--r-lg);
  padding: 20px 22px; cursor: pointer; transition: all 0.2s; box-shadow: var(--shadow);
  position: relative; overflow: hidden;
}
.pcard:hover { border-color: var(--border2); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.1); }
.pcard-accent { position: absolute; top: 0; left: 0; right: 0; height: 3px; }
.pcard-top { display: flex; align-items: center; justify-content: space-between; margin-bottom: 14px; }
.pcard-icon { width: 38px; height: 38px; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
.pcard-badges { display: flex; gap: 5px; align-items: center; }
.pcard-badge { font-family: var(--mono); font-size: 10px; padding: 3px 8px; border-radius: 20px; font-weight: 500; white-space: nowrap; }
.badge-daily  { background: var(--amber-lt); color: var(--amber); }
.badge-weekly { background: var(--blue-lt);  color: var(--blue); }
.badge-monthly{ background: var(--purple-lt);color: var(--purple); }
.badge-tg { background: var(--telegram-lt); color: var(--telegram); font-size: 9px; padding: 2px 6px; }

.pcard-name { font-size: 15px; font-weight: 700; margin-bottom: 5px; letter-spacing: -0.2px; }
.pcard-desc { font-size: 12.5px; color: var(--text2); margin-bottom: 14px; line-height: 1.5; height: 38px; overflow: hidden; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; }
.pcard-progress-head { display: flex; justify-content: space-between; align-items: center; margin-bottom: 7px; }
.pcard-progress-label { font-family: var(--mono); font-size: 9px; color: var(--text3); letter-spacing: 1px; text-transform: uppercase; }
.pcard-pct { font-family: var(--mono); font-size: 12px; font-weight: 700; }
.prog-bar { height: 5px; background: var(--bg2); border-radius: 5px; overflow: hidden; margin-bottom: 14px; }
.prog-fill { height: 100%; border-radius: 5px; transition: width 0.7s cubic-bezier(0.4,0,0.2,1); }
.pcard-footer { display: flex; align-items: center; gap: 8px; flex-wrap: wrap; }
.pcard-pill { display: flex; align-items: center; gap: 4px; font-size: 11px; color: var(--text3); font-family: var(--mono); }
.pcard-pill-dot { width: 6px; height: 6px; border-radius: 50%; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROJECT DETAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.detail-header {
  background: var(--surface); border: 1px solid var(--border); border-radius: var(--r-lg);
  padding: 26px 28px; margin-bottom: 20px; box-shadow: var(--shadow); position: relative; overflow: hidden;
}
.detail-header-accent { position: absolute; top: 0; left: 0; right: 0; height: 4px; border-radius: var(--r-lg) var(--r-lg) 0 0; }
.detail-top { display: flex; align-items: flex-start; gap: 16px; margin-bottom: 22px; }
.detail-icon { width: 54px; height: 54px; border-radius: 14px; display: flex; align-items: center; justify-content: center; font-size: 26px; flex-shrink: 0; }
.detail-title { font-size: 24px; font-weight: 800; letter-spacing: -0.5px; margin-bottom: 4px; }
.detail-desc-text { font-size: 14px; color: var(--text2); line-height: 1.55; }
.detail-actions { display: flex; gap: 8px; flex-shrink: 0; margin-left: auto; flex-wrap: wrap; justify-content: flex-end; }
.detail-kpis { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-bottom: 20px; }
.dkpi { background: var(--bg); border: 1px solid var(--border); border-radius: var(--r-sm); padding: 12px 14px; }
.dkpi-label { font-family: var(--mono); font-size: 9px; color: var(--text3); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 5px; }
.dkpi-val { font-size: 20px; font-weight: 800; }
.dkpi-sub { font-size: 11px; color: var(--text3); margin-top: 2px; }

.big-prog-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 10px; }
.big-prog-label { font-size: 13px; font-weight: 600; color: var(--text2); }
.big-prog-pct { font-family: var(--mono); font-size: 24px; font-weight: 700; }
.big-prog-bar { height: 12px; background: var(--bg2); border-radius: 12px; overflow: hidden; margin-bottom: 12px; }
.big-prog-fill { height: 100%; border-radius: 12px; transition: width 0.6s cubic-bezier(0.4,0,0.2,1); position: relative; }
.big-prog-fill::after { content: ''; position: absolute; right: 0; top: 0; bottom: 0; width: 20px; background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3)); }
.slider-row { display: flex; align-items: center; gap: 12px; }
.prog-slider { flex: 1; -webkit-appearance: none; height: 4px; background: var(--bg3); border-radius: 4px; outline: none; cursor: pointer; }
.prog-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: white; border: 2.5px solid var(--blue); box-shadow: 0 2px 8px rgba(37,99,235,0.4); cursor: pointer; transition: transform 0.15s; }
.prog-slider::-webkit-slider-thumb:hover { transform: scale(1.15); }
.pct-box { display: flex; align-items: center; background: var(--bg); border: 1.5px solid var(--border); border-radius: var(--r-sm); overflow: hidden; transition: border-color 0.15s; }
.pct-box:focus-within { border-color: var(--blue); }
.pct-inp { width: 48px; border: none; background: none; font-family: var(--mono); font-size: 13px; font-weight: 500; color: var(--text); text-align: center; padding: 7px 4px; outline: none; }
.pct-sym { font-family: var(--mono); font-size: 12px; color: var(--text3); padding-right: 9px; }

.detail-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
.detail-grid .full-width { grid-column: 1 / -1; }

.card { background: var(--surface); border: 1px solid var(--border); border-radius: var(--r-lg); box-shadow: var(--shadow); overflow: hidden; transition: background 0.3s, border-color 0.3s; }
.card-head { display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; border-bottom: 1px solid var(--border); }
.card-title { font-size: 13px; font-weight: 700; }
.card-meta { font-family: var(--mono); font-size: 11px; color: var(--text3); }

/* Tasks */
.task-item { display: flex; align-items: center; gap: 11px; padding: 11px 20px; border-bottom: 1px solid var(--border); transition: background 0.12s; }
.task-item:last-child { border-bottom: none; }
.task-item:hover { background: var(--bg2); }
.task-check { width: 19px; height: 19px; border-radius: 5px; border: 2px solid var(--border2); flex-shrink: 0; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.15s; background: var(--surface); }
.task-check:hover { border-color: var(--blue); }
.task-check.done { background: var(--green); border-color: var(--green); }
.task-check.done::after { content: 'âœ“'; font-size: 11px; color: white; font-weight: 700; }
.task-name-text { font-size: 13px; font-weight: 500; flex: 1; transition: color 0.15s; }
.task-name-text.done { text-decoration: line-through; color: var(--text3); }
.task-del { width: 24px; height: 24px; border-radius: 6px; background: none; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 12px; color: var(--text3); opacity: 0; transition: all 0.12s; }
.task-item:hover .task-del { opacity: 1; }
.task-del:hover { background: var(--red-lt); color: var(--red); }
.task-add-row { display: flex; align-items: center; gap: 10px; padding: 10px 20px; background: var(--bg2); border-top: 1px solid var(--border); }
.task-add-inp { flex: 1; background: none; border: none; outline: none; font-family: var(--font); font-size: 13px; color: var(--text); }
.task-add-inp::placeholder { color: var(--text3); }

/* Stage */
.stage-opts { padding: 10px 14px; display: flex; flex-direction: column; gap: 4px; }
.stage-opt { display: flex; align-items: center; gap: 10px; padding: 9px 10px; border-radius: var(--r-sm); cursor: pointer; transition: all 0.15s; border: 1.5px solid transparent; }
.stage-opt:hover { background: var(--bg2); }
.stage-opt.active { border-color: var(--blue); background: var(--blue-lt2); }
.stage-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
.stage-name { font-size: 13px; font-weight: 500; flex: 1; }
.stage-opt.active .stage-name { color: var(--blue); font-weight: 600; }
.stage-pct-label { font-family: var(--mono); font-size: 11px; color: var(--text3); }
.stage-opt.active .stage-pct-label { color: var(--blue); }

/* Priority */
.pri-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding: 14px; }
.pri-btn { padding: 10px; border-radius: var(--r-sm); border: 1.5px solid var(--border); background: var(--bg); cursor: pointer; text-align: center; font-family: var(--font); font-size: 12px; font-weight: 600; color: var(--text2); transition: all 0.15s; }
.pri-btn.ph.on { background: var(--red-lt); color: var(--red); border-color: rgba(220,38,38,0.25); }
.pri-btn.pm.on { background: var(--amber-lt); color: var(--amber); border-color: rgba(217,119,6,0.25); }
.pri-btn.pl.on { background: var(--green-lt); color: var(--green); border-color: rgba(22,163,74,0.25); }
.pri-btn.pn.on { background: var(--bg3); color: var(--text3); border-color: var(--border2); }

/* Notes */
.notes-ta { width: 100%; min-height: 160px; background: none; border: none; outline: none; font-family: var(--font); font-size: 13.5px; line-height: 1.7; color: var(--text); padding: 15px 20px; resize: none; }
.notes-ta::placeholder { color: var(--text3); }

/* Activity */
.activity-item { display: flex; gap: 12px; padding: 10px 20px; border-bottom: 1px solid var(--border); }
.activity-item:last-child { border-bottom: none; }
.activity-dot { width: 8px; height: 8px; border-radius: 50%; margin-top: 5px; flex-shrink: 0; }
.activity-text { font-size: 12.5px; color: var(--text2); line-height: 1.5; flex: 1; }
.activity-text strong { color: var(--text); font-weight: 600; }
.activity-time { font-family: var(--mono); font-size: 10px; color: var(--text3); flex-shrink: 0; margin-top: 2px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TELEGRAM CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tg-card { padding: 16px 20px; }
.tg-toggle-row { display: flex; align-items: center; gap: 12px; margin-bottom: 14px; }
.tg-toggle-label { flex: 1; }
.tg-toggle-title { font-size: 13px; font-weight: 600; margin-bottom: 2px; }
.tg-toggle-desc { font-size: 11.5px; color: var(--text3); line-height: 1.4; }
.tg-switch { width: 42px; height: 24px; background: var(--bg3); border-radius: 24px; position: relative; cursor: pointer; transition: background 0.2s; flex-shrink: 0; border: none; }
.tg-switch.on { background: var(--telegram); }
.tg-switch::after { content: ''; position: absolute; top: 3px; left: 3px; width: 18px; height: 18px; background: white; border-radius: 50%; transition: left 0.2s cubic-bezier(0.34,1.56,0.64,1); box-shadow: 0 1px 4px rgba(0,0,0,0.2); }
.tg-switch.on::after { left: 21px; }
.tg-fields { display: flex; flex-direction: column; gap: 10px; }
.tg-field-label { font-family: var(--mono); font-size: 10px; color: var(--text3); letter-spacing: 1px; text-transform: uppercase; margin-bottom: 4px; }
.tg-info-box {
  background: var(--telegram-lt); border: 1px solid rgba(34,158,217,0.25);
  border-radius: var(--r-sm); padding: 10px 12px; font-size: 12px; color: var(--telegram);
  line-height: 1.5; margin-top: 4px;
}
.tg-info-box a { color: var(--telegram); font-weight: 600; }
.tg-time-row { display: flex; gap: 8px; align-items: center; }
.tg-test-btn { margin-top: 8px; }
.tg-status { font-size: 11px; color: var(--text3); margin-top: 6px; font-family: var(--mono); }
.tg-status.ok { color: var(--green); }
.tg-status.err { color: var(--red); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SETTINGS / GITHUB MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.settings-tabs { display: flex; gap: 4px; padding: 16px 24px 0; border-bottom: 1px solid var(--border); }
.stab { padding: 8px 16px; font-size: 13px; font-weight: 600; color: var(--text2); cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -1px; transition: all 0.15s; border-top: none; border-left: none; border-right: none; background: none; font-family: var(--font); }
.stab.active { color: var(--blue); border-bottom-color: var(--blue); }
.stab-pane { display: none; }
.stab-pane.active { display: block; }

.github-setup-steps { display: flex; flex-direction: column; gap: 14px; }
.setup-step { display: flex; gap: 12px; }
.step-num { width: 26px; height: 26px; border-radius: 50%; background: var(--blue); color: white; font-size: 12px; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 1px; }
.step-body { flex: 1; }
.step-title { font-size: 13px; font-weight: 600; margin-bottom: 4px; }
.step-desc { font-size: 12px; color: var(--text2); line-height: 1.5; }
.code-snippet { background: var(--bg2); border: 1px solid var(--border); border-radius: 6px; padding: 8px 12px; font-family: var(--mono); font-size: 11px; color: var(--text2); margin-top: 6px; position: relative; overflow-x: auto; }
.copy-btn { position: absolute; right: 6px; top: 6px; padding: 2px 7px; font-size: 10px; border-radius: 4px; background: var(--bg3); border: 1px solid var(--border); cursor: pointer; color: var(--text2); font-family: var(--mono); }
.copy-btn:hover { background: var(--blue); color: white; border-color: var(--blue); }

.sync-status-row { display: flex; align-items: center; gap: 8px; padding: 10px 0; font-size: 13px; }
.sync-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(8px); z-index: 500; display: flex; align-items: center; justify-content: center; opacity: 0; pointer-events: none; transition: opacity 0.2s; }
.overlay.open { opacity: 1; pointer-events: all; }
.modal { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; width: 520px; max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg); transform: scale(0.96) translateY(16px); transition: transform 0.28s cubic-bezier(0.34,1.56,0.64,1); }
.modal-wide { width: 600px; }
.modal::-webkit-scrollbar { width: 0; }
.overlay.open .modal { transform: scale(1) translateY(0); }
.modal-head { display: flex; align-items: center; justify-content: space-between; padding: 22px 24px 18px; border-bottom: 1px solid var(--border); position: sticky; top: 0; background: var(--surface); z-index: 1; }
.modal-title { font-size: 17px; font-weight: 800; }
.modal-x { width: 30px; height: 30px; border-radius: 8px; background: var(--bg2); border: 1px solid var(--border); cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 13px; color: var(--text2); transition: all 0.15s; }
.modal-x:hover { background: var(--bg3); }
.modal-body { padding: 22px 24px; display: flex; flex-direction: column; gap: 18px; }
.modal-foot { padding: 16px 24px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 10px; position: sticky; bottom: 0; background: var(--surface); }

/* Form */
.field { display: flex; flex-direction: column; gap: 7px; }
.fl { font-family: var(--mono); font-size: 10px; letter-spacing: 1.5px; color: var(--text3); text-transform: uppercase; }
.fi, .fta, .fsel { background: var(--bg); border: 1.5px solid var(--border); border-radius: var(--r-sm); padding: 11px 13px; font-family: var(--font); font-size: 14px; color: var(--text); outline: none; transition: all 0.15s; width: 100%; }
.fi:focus, .fta:focus, .fsel:focus { border-color: var(--blue); background: var(--surface); box-shadow: 0 0 0 3px rgba(37,99,235,0.08); }
.fta { resize: vertical; min-height: 72px; line-height: 1.5; }
.fsel option { background: var(--surface); color: var(--text); }
.f2col { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }

.type-chips { display: flex; gap: 8px; }
.tc { flex: 1; padding: 10px 8px; border-radius: var(--r-sm); border: 1.5px solid var(--border); background: var(--bg); cursor: pointer; text-align: center; font-family: var(--font); font-size: 12px; font-weight: 600; color: var(--text2); transition: all 0.15s; }
.tc.td.on { background: var(--amber-lt); color: var(--amber); border-color: rgba(217,119,6,0.3); }
.tc.tw.on { background: var(--blue-lt);  color: var(--blue);  border-color: rgba(37,99,235,0.3); }
.tc.tm.on { background: var(--purple-lt);color: var(--purple);border-color: rgba(124,58,237,0.3); }

.swatches { display: flex; gap: 8px; flex-wrap: wrap; }
.sw { width: 26px; height: 26px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; transition: all 0.15s; outline: 2px solid transparent; outline-offset: 2px; }
.sw.on { outline-color: var(--text); transform: scale(1.1); }

/* TG form in modal */
.tg-modal-section {
  border: 1.5px solid var(--border); border-radius: var(--r); padding: 16px;
  background: var(--bg2); display: flex; flex-direction: column; gap: 12px;
}
.tg-modal-header { display: flex; align-items: center; gap: 10px; }
.tg-modal-icon { font-size: 20px; }
.tg-modal-title { font-size: 13px; font-weight: 700; }
.tg-modal-sub { font-size: 12px; color: var(--text2); margin-top: 1px; }
.tg-toggle-wrap { display: flex; align-items: center; gap: 8px; }
.tg-toggle-text { font-size: 12.5px; font-weight: 600; color: var(--text2); }

.confirm-body { padding: 32px 24px; text-align: center; }
.confirm-icon { font-size: 44px; margin-bottom: 16px; }
.confirm-title { font-size: 18px; font-weight: 800; margin-bottom: 8px; }
.confirm-desc { font-size: 13.5px; color: var(--text2); line-height: 1.6; max-width: 280px; margin: 0 auto 24px; }
.confirm-btns { display: flex; gap: 10px; justify-content: center; }

.empty { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%; text-align: center; padding: 60px 40px; }
.empty-ill { width: 90px; height: 90px; background: var(--bg2); border: 1px solid var(--border); border-radius: 24px; display: flex; align-items: center; justify-content: center; font-size: 40px; margin-bottom: 20px; }
.empty-title { font-size: 18px; font-weight: 800; margin-bottom: 8px; }
.empty-desc { font-size: 13.5px; color: var(--text2); line-height: 1.6; max-width: 300px; margin-bottom: 24px; }

.toast-wrap { position: fixed; bottom: 24px; right: 24px; z-index: 9999; display: flex; flex-direction: column-reverse; gap: 8px; pointer-events: none; }
.toast { display: flex; align-items: center; gap: 10px; background: var(--text); color: var(--bg); padding: 12px 18px; border-radius: 12px; font-size: 13px; font-weight: 500; box-shadow: 0 8px 28px rgba(0,0,0,0.2); transform: translateY(20px) scale(0.95); opacity: 0; transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1); pointer-events: all; min-width: 220px; }
.toast.show { transform: translateY(0) scale(1); opacity: 1; }
.toast-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }

@keyframes fadeUp { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
.au  { animation: fadeUp 0.3s ease both; }
.au1 { animation-delay: 0.04s; }
.au2 { animation-delay: 0.08s; }
.au3 { animation-delay: 0.12s; }
.au4 { animation-delay: 0.16s; }

.due-ok   { background: var(--green-lt); color: var(--green); }
.due-soon { background: var(--amber-lt); color: var(--amber); }
.due-late { background: var(--red-lt); color: var(--red); }
.due-chip { display: inline-flex; align-items: center; gap: 4px; font-family: var(--mono); font-size: 10px; padding: 3px 9px; border-radius: 20px; }

/* Divider in modal */
.modal-divider { height: 1px; background: var(--border); margin: 2px 0; }

/* Responsive: mobile */
@media (max-width: 768px) {
  .app { grid-template-columns: 1fr; }
  .sidebar { display: none; }
  .dash-kpis { grid-template-columns: repeat(2, 1fr); }
  .detail-kpis { grid-template-columns: repeat(2, 1fr); }
  .detail-grid { grid-template-columns: 1fr; }
  .content { padding: 16px; }
}
</style>
</head>
<body>

<!-- Toasts -->
<div class="toast-wrap" id="toastWrap"></div>

<!-- Add/Edit Modal -->
<div class="overlay" id="addOverlay">
  <div class="modal">
    <div class="modal-head">
      <div class="modal-title" id="modal-title-txt">New Project</div>
      <button class="modal-x" onclick="closeAdd()">âœ•</button>
    </div>
    <div class="modal-body">
      <div class="field">
        <div class="fl">Project Name *</div>
        <input class="fi" id="f-name" placeholder="What are you working on?" />
      </div>
      <div class="field">
        <div class="fl">Description</div>
        <textarea class="fta" id="f-desc" placeholder="Goals, scope, context..."></textarea>
      </div>
      <div class="field">
        <div class="fl">Type</div>
        <div class="type-chips">
          <div class="tc td on" onclick="selType('daily',this)">âš¡ Daily</div>
          <div class="tc tw"    onclick="selType('weekly',this)">ğŸ“… Weekly</div>
          <div class="tc tm"    onclick="selType('monthly',this)">ğŸ—“ Monthly</div>
        </div>
      </div>
      <div class="f2col">
        <div class="field">
          <div class="fl">Due Date</div>
          <input class="fi" id="f-due" type="date" />
        </div>
        <div class="field">
          <div class="fl">Priority</div>
          <select class="fsel" id="f-pri">
            <option value="high">ğŸ”´ High</option>
            <option value="med" selected>ğŸŸ¡ Medium</option>
            <option value="low">ğŸŸ¢ Low</option>
          </select>
        </div>
      </div>
      <div class="f2col">
        <div class="field">
          <div class="fl">Emoji / Icon</div>
          <input class="fi" id="f-icon" placeholder="ğŸš€ ğŸ’¡ ğŸ¯" maxlength="4" />
        </div>
        <div class="field">
          <div class="fl">Color</div>
          <div class="swatches" id="swatches">
            <div class="sw on" data-c="#2563EB" style="background:#2563EB" onclick="selColor(this)"></div>
            <div class="sw" data-c="#16A34A" style="background:#16A34A" onclick="selColor(this)"></div>
            <div class="sw" data-c="#D97706" style="background:#D97706" onclick="selColor(this)"></div>
            <div class="sw" data-c="#DC2626" style="background:#DC2626" onclick="selColor(this)"></div>
            <div class="sw" data-c="#7C3AED" style="background:#7C3AED" onclick="selColor(this)"></div>
            <div class="sw" data-c="#0891B2" style="background:#0891B2" onclick="selColor(this)"></div>
            <div class="sw" data-c="#E11D48" style="background:#E11D48" onclick="selColor(this)"></div>
            <div class="sw" data-c="#1C1B18" style="background:#1C1B18" onclick="selColor(this)"></div>
          </div>
        </div>
      </div>
      <div class="field">
        <div class="fl">Initial Progress %</div>
        <div class="slider-row">
          <input type="range" class="prog-slider" id="f-sl" min="0" max="100" value="0"
            oninput="document.getElementById('f-pn').value=this.value">
          <div class="pct-box">
            <input class="pct-inp" id="f-pn" type="number" min="0" max="100" value="0"
              oninput="document.getElementById('f-sl').value=Math.min(100,Math.max(0,parseInt(this.value)||0))">
            <span class="pct-sym">%</span>
          </div>
        </div>
      </div>

      <!-- Telegram section -->
      <div class="modal-divider"></div>
      <div class="tg-modal-section" id="tg-modal-section">
        <div class="tg-modal-header">
          <span class="tg-modal-icon">âœˆï¸</span>
          <div>
            <div class="tg-modal-title">Telegram Reminders <span style="font-family:var(--mono);font-size:10px;color:var(--text3);font-weight:400">OPTIONAL</span></div>
            <div class="tg-modal-sub">Get a daily reminder for tasks in this project</div>
          </div>
          <div style="margin-left:auto">
            <div class="tg-toggle-wrap">
              <span class="tg-toggle-text" id="tg-f-label">Off</span>
              <button class="tg-switch" id="tg-f-switch" onclick="toggleModalTg()"></button>
            </div>
          </div>
        </div>
        <div id="tg-f-fields" style="display:none;flex-direction:column;gap:10px">
          <div id="tg-global-warning" class="tg-info-box" style="display:none">
            âš™ï¸ Configure your Telegram Bot first in <strong>Settings â†’ Telegram</strong> to enable reminders.
          </div>
          <div class="field">
            <div class="fl">Reminder Time</div>
            <input class="fi" id="tg-f-time" type="time" value="09:00" />
          </div>
          <div class="field">
            <div class="fl">Custom Message (optional)</div>
            <input class="fi" id="tg-f-msg" placeholder="e.g. Time to check on this project!" />
          </div>
        </div>
      </div>
    </div>
    <div class="modal-foot">
      <button class="btn btn-ghost" onclick="closeAdd()">Cancel</button>
      <button class="btn btn-primary" onclick="saveProject()">Save Project</button>
    </div>
  </div>
</div>

<!-- Confirm Delete -->
<div class="overlay" id="delOverlay">
  <div class="modal" style="width:380px">
    <div class="confirm-body">
      <div class="confirm-icon">ğŸ—‘</div>
      <div class="confirm-title">Delete Project?</div>
      <div class="confirm-desc" id="del-desc">This action is permanent.</div>
      <div class="confirm-btns">
        <button class="btn btn-ghost" onclick="closeDel()">Cancel</button>
        <button class="btn btn-danger" onclick="doDelete()">Delete Forever</button>
      </div>
    </div>
  </div>
</div>

<!-- Settings Modal -->
<div class="overlay" id="settingsOverlay">
  <div class="modal modal-wide">
    <div class="modal-head">
      <div class="modal-title">âš™ï¸ Settings</div>
      <button class="modal-x" onclick="closeSettings()">âœ•</button>
    </div>
    <div class="settings-tabs">
      <button class="stab active" onclick="switchTab('tab-telegram',this)">âœˆï¸ Telegram</button>
      <button class="stab" onclick="switchTab('tab-github',this)">ğŸ™ GitHub / Sync</button>
      <button class="stab" onclick="switchTab('tab-data',this)">ğŸ’¾ Data</button>
    </div>

    <!-- Telegram Tab -->
    <div class="stab-pane active" id="tab-telegram">
      <div class="modal-body">
        <div style="font-size:13px;color:var(--text2);line-height:1.6">
          Connect a Telegram bot to receive daily reminders for projects that have notifications enabled. Each project can have its own reminder time.
        </div>
        <div class="tg-info-box">
          <strong>How to set up:</strong><br>
          1. Open Telegram â†’ search <strong>@BotFather</strong> â†’ send <code>/newbot</code><br>
          2. Copy the Bot Token it gives you<br>
          3. Start your bot by messaging it once<br>
          4. Find your Chat ID: message <strong>@userinfobot</strong><br>
          5. Paste both values below and click Test
        </div>
        <div class="field">
          <div class="fl">Bot Token</div>
          <input class="fi" id="tg-token" placeholder="123456789:ABCdefGhi..." />
        </div>
        <div class="field">
          <div class="fl">Chat ID</div>
          <input class="fi" id="tg-chatid" placeholder="Your Telegram user ID (e.g. 123456789)" />
        </div>
        <div style="display:flex;gap:10px;align-items:center">
          <button class="btn btn-telegram btn-sm" onclick="testTelegram()">ğŸ“¨ Send Test Message</button>
          <button class="btn btn-ghost btn-sm" onclick="saveTelegramSettings()">Save</button>
          <span class="tg-status" id="tg-test-status"></span>
        </div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:14px">
          <div style="font-size:12px;font-weight:700;margin-bottom:8px;color:var(--text2)">ğŸ“‹ Projects with Reminders</div>
          <div id="tg-project-list" style="font-size:12.5px;color:var(--text2)">No reminders configured.</div>
        </div>
      </div>
    </div>

    <!-- GitHub Tab -->
    <div class="stab-pane" id="tab-github">
      <div class="modal-body">
        <div style="font-size:13px;color:var(--text2);line-height:1.6">
          Host this app on GitHub Pages for free cloud access from any device â€” desktop, mobile, tablet. Your data is stored in the browser's localStorage on each device. Use the export/import below to sync between devices.
        </div>
        <div class="github-setup-steps">
          <div class="setup-step">
            <div class="step-num">1</div>
            <div class="step-body">
              <div class="step-title">Create a GitHub repository</div>
              <div class="step-desc">Go to <a href="https://github.com/new" target="_blank" style="color:var(--blue)">github.com/new</a> â†’ name it <code>projects-center</code> â†’ keep it <strong>Public</strong> â†’ click Create</div>
            </div>
          </div>
          <div class="setup-step">
            <div class="step-num">2</div>
            <div class="step-body">
              <div class="step-title">Upload this file</div>
              <div class="step-desc">Click <strong>uploading an existing file</strong> â†’ drag <code>projects-center.html</code> â†’ rename it to <code>index.html</code> â†’ Commit changes</div>
            </div>
          </div>
          <div class="setup-step">
            <div class="step-num">3</div>
            <div class="step-body">
              <div class="step-title">Enable GitHub Pages</div>
              <div class="step-desc">Go to <strong>Settings â†’ Pages</strong> â†’ Source: <strong>Deploy from a branch</strong> â†’ Branch: <strong>main / root</strong> â†’ Save</div>
            </div>
          </div>
          <div class="setup-step">
            <div class="step-num">4</div>
            <div class="step-body">
              <div class="step-title">Access from anywhere</div>
              <div class="step-desc">Your app will be live at: <code>https://YOUR_USERNAME.github.io/projects-center</code><br>Bookmark it on your phone! Save as home screen app in Safari/Chrome.</div>
            </div>
          </div>
          <div class="setup-step">
            <div class="step-num">5</div>
            <div class="step-body">
              <div class="step-title">Keep data in sync between devices</div>
              <div class="step-desc">Use the <strong>Export</strong> and <strong>Import</strong> buttons (Data tab) to move your data between devices. Or, configure a GitHub Gist token below for one-click cloud backup.</div>
            </div>
          </div>
        </div>

        <div style="border-top:1px solid var(--border);padding-top:16px;margin-top:4px">
          <div style="font-size:13px;font-weight:700;margin-bottom:12px">ğŸ”— GitHub Gist Backup (Optional)</div>
          <div style="font-size:12px;color:var(--text2);margin-bottom:12px;line-height:1.5">Generate a GitHub Personal Access Token with <strong>gist</strong> scope at <a href="https://github.com/settings/tokens" target="_blank" style="color:var(--blue)">github.com/settings/tokens</a> to enable one-click cloud sync.</div>
          <div class="field">
            <div class="fl">GitHub Token (gist scope)</div>
            <input class="fi" id="gh-token" placeholder="ghp_xxxxxxxxxxxx" type="password" />
          </div>
          <div class="field" style="margin-top:10px">
            <div class="fl">Gist ID (auto-filled after first backup)</div>
            <input class="fi" id="gh-gist-id" placeholder="Leave blank to create new" />
          </div>
          <div style="display:flex;gap:8px;margin-top:10px">
            <button class="btn btn-primary btn-sm" onclick="saveToGist()">â˜ï¸ Backup to Gist</button>
            <button class="btn btn-ghost btn-sm" onclick="loadFromGist()">â¬‡ï¸ Restore from Gist</button>
            <span id="gh-status" style="font-size:11px;color:var(--text3);font-family:var(--mono);line-height:1;align-self:center"></span>
          </div>
        </div>
      </div>
    </div>

    <!-- Data Tab -->
    <div class="stab-pane" id="tab-data">
      <div class="modal-body">
        <div style="font-size:13px;color:var(--text2);line-height:1.6">Manage your local project data. Export creates a JSON backup file. Import restores from a backup. This is the easiest way to move data between devices.</div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:18px;text-align:center">
            <div style="font-size:28px;margin-bottom:8px">ğŸ“¤</div>
            <div style="font-size:13px;font-weight:700;margin-bottom:4px">Export Data</div>
            <div style="font-size:12px;color:var(--text2);margin-bottom:12px">Download all projects as JSON</div>
            <button class="btn btn-ghost btn-sm" onclick="exportData()" style="width:100%">Export JSON</button>
          </div>
          <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:18px;text-align:center">
            <div style="font-size:28px;margin-bottom:8px">ğŸ“¥</div>
            <div style="font-size:13px;font-weight:700;margin-bottom:4px">Import Data</div>
            <div style="font-size:12px;color:var(--text2);margin-bottom:12px">Restore from a JSON backup</div>
            <button class="btn btn-ghost btn-sm" onclick="document.getElementById('import-file').click()" style="width:100%">Import JSON</button>
            <input type="file" id="import-file" accept=".json" style="display:none" onchange="importData(event)">
          </div>
        </div>
        <div style="background:var(--bg2);border:1px solid var(--border);border-radius:var(--r);padding:14px">
          <div style="font-size:12px;font-weight:700;margin-bottom:8px">ğŸ“Š Storage Info</div>
          <div id="storage-info" style="font-size:12px;color:var(--text2)">Loading...</div>
        </div>
        <div style="border-top:1px solid var(--border);padding-top:16px">
          <div style="font-size:13px;font-weight:700;color:var(--red);margin-bottom:8px">âš ï¸ Danger Zone</div>
          <button class="btn btn-danger btn-sm" onclick="clearAllData()">ğŸ—‘ Clear All Data</button>
          <div style="font-size:12px;color:var(--text3);margin-top:6px">This will permanently delete all projects and activity. Cannot be undone.</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• APP â•â•â•â•â•â•â• -->
<div class="app">

  <!-- SIDEBAR -->
  <aside class="sidebar">
    <div class="logo-area">
      <div class="logo-row">
        <div class="logo-mark">
          <svg viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect width="40" height="40" rx="10" fill="#2563EB"/>
            <rect x="8" y="8" width="10" height="10" rx="2.5" fill="white" opacity="0.9"/>
            <rect x="22" y="8" width="10" height="10" rx="2.5" fill="white" opacity="0.6"/>
            <rect x="8" y="22" width="10" height="10" rx="2.5" fill="white" opacity="0.6"/>
            <rect x="22" y="22" width="10" height="10" rx="2.5" fill="white" opacity="0.3"/>
            <circle cx="27" cy="27" r="5" fill="#22C55E"/>
            <path d="M24.5 27l1.8 1.8 3-3" stroke="white" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="logo-text-wrap">
          <div class="logo-name">Projects Center</div>
          <div class="logo-tagline">Workspace</div>
        </div>
      </div>
      <div class="github-badge" onclick="openSettings('tab-github')" title="GitHub Setup">
        <div class="github-dot offline" id="gh-status-dot"></div>
        <span id="gh-status-label">Setup GitHub Sync</span>
      </div>
    </div>

    <div class="sidebar-body">
      <div class="nav-section">
        <div class="nav-section-label">Main</div>
        <button class="nav-item active" id="nav-dashboard" onclick="goView('dashboard')">
          <div class="nav-icon">âŠ</div>
          <span class="nav-label">Dashboard</span>
        </button>
        <button class="nav-item" id="nav-all" onclick="goView('all')">
          <div class="nav-icon">â—ˆ</div>
          <span class="nav-label">All Projects</span>
          <span class="nav-badge" id="nb-all">0</span>
        </button>
        <button class="nav-item" id="nav-daily" onclick="goView('daily')">
          <div class="nav-icon">âš¡</div>
          <span class="nav-label">Daily</span>
          <span class="nav-badge" id="nb-daily">0</span>
        </button>
        <button class="nav-item" id="nav-weekly" onclick="goView('weekly')">
          <div class="nav-icon">ğŸ“…</div>
          <span class="nav-label">Weekly</span>
          <span class="nav-badge" id="nb-weekly">0</span>
        </button>
        <button class="nav-item" id="nav-monthly" onclick="goView('monthly')">
          <div class="nav-icon">ğŸ—“</div>
          <span class="nav-label">Monthly</span>
          <span class="nav-badge" id="nb-monthly">0</span>
        </button>
      </div>

      <div class="nav-section">
        <div class="nav-section-label">Projects</div>
        <div id="sidebar-project-list"></div>
        <button class="sidebar-add" onclick="openAdd()">+ New Project</button>
      </div>

      <div class="nav-section">
        <div class="nav-section-label">Filters</div>
        <button class="nav-item" id="nav-done" onclick="goView('done')">
          <div class="nav-icon">âœ…</div>
          <span class="nav-label">Completed</span>
          <span class="nav-badge" id="nb-done">0</span>
        </button>
        <button class="nav-item" id="nav-overdue" onclick="goView('overdue')">
          <div class="nav-icon">âš ï¸</div>
          <span class="nav-label">Overdue</span>
          <span class="nav-badge" id="nb-overdue">0</span>
        </button>
      </div>
    </div>

    <div class="sidebar-foot">
      <button class="theme-toggle" onclick="toggleTheme()">
        <div class="nav-icon" id="theme-icon">ğŸŒ™</div>
        <span id="theme-label">Dark Mode</span>
        <div class="theme-pill" id="theme-pill"></div>
      </button>
      <button class="export-btn" onclick="openSettings('tab-data')">
        <span style="font-size:13px">ğŸ’¾</span>
        <span>Export / Import Data</span>
      </button>
      <button class="export-btn" onclick="openSettings('tab-telegram')">
        <span style="font-size:13px">âœˆï¸</span>
        <span>Telegram Notifications</span>
      </button>
    </div>
  </aside>

  <!-- MAIN -->
  <div class="main">
    <div class="topbar">
      <div class="topbar-title" id="tb-title">Dashboard</div>
      <div class="topbar-divider"></div>
      <div class="topbar-crumb" id="tb-crumb">Overview</div>
      <div class="topbar-space"></div>
      <div id="tb-view-tabs"></div>
      <div id="tb-actions" style="display:flex;gap:8px"></div>
      <button class="btn btn-ghost btn-sm" onclick="openSettings('tab-telegram')" title="Settings">âš™ï¸</button>
      <button class="btn btn-primary btn-sm" onclick="openAdd()">+ New</button>
    </div>
    <div class="content" id="content"></div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let D = [];
let theme = 'light';
let view = 'dashboard';
let activeProject = null;
let editingId = null;
let deleteId = null;
let newType = 'daily';
let newColor = '#2563EB';
let activityLog = [];
let modalTgEnabled = false;

function loadState() {
  try { D = JSON.parse(localStorage.getItem('pc_v4') || '[]'); } catch(e) { D = []; }
  try { activityLog = JSON.parse(localStorage.getItem('pc_activity') || '[]'); } catch(e) { activityLog = []; }
  theme = localStorage.getItem('pc_theme') || 'light';
  document.documentElement.setAttribute('data-theme', theme);
  updateThemeUI();
}
loadState();

function save() {
  try {
    localStorage.setItem('pc_v4', JSON.stringify(D));
    localStorage.setItem('pc_activity', JSON.stringify(activityLog.slice(0, 100)));
  } catch(e) { toast('Storage full! Export your data.', '#DC2626'); }
}

function logActivity(msg, color='#2563EB') {
  activityLog.unshift({ msg, color, time: Date.now() });
  save();
}

function relTime(ts) {
  const d = Math.floor((Date.now() - ts) / 60000);
  if (d < 1) return 'just now';
  if (d < 60) return `${d}m ago`;
  if (d < 1440) return `${Math.floor(d/60)}h ago`;
  return `${Math.floor(d/1440)}d ago`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  THEME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTheme() {
  theme = theme === 'light' ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('pc_theme', theme);
  updateThemeUI();
}
function updateThemeUI() {
  const isDark = theme === 'dark';
  const icon = document.getElementById('theme-icon');
  const label = document.getElementById('theme-label');
  if (icon) icon.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
  if (label) label.textContent = isDark ? 'Light Mode' : 'Dark Mode';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function pctColor(p) {
  if (p >= 75) return '#16A34A';
  if (p >= 40) return '#D97706';
  return '#DC2626';
}
function dueInfo(due) {
  if (!due) return null;
  const d = new Date(due + 'T00:00:00');
  const now = new Date(); now.setHours(0,0,0,0);
  const diff = Math.ceil((d - now) / 86400000);
  const fmt = d.toLocaleDateString('en-US', {month:'short', day:'numeric'});
  if (diff < 0)   return { cls:'due-late', txt:`Overdue Â· ${fmt}` };
  if (diff === 0) return { cls:'due-soon', txt:`Due today` };
  if (diff <= 3)  return { cls:'due-soon', txt:`${diff}d left Â· ${fmt}` };
  return { cls:'due-ok', txt:`Due ${fmt}` };
}
function typeLabel(t) { return {daily:'âš¡ Daily',weekly:'ğŸ“… Weekly',monthly:'ğŸ—“ Monthly'}[t]||t; }
function typeBadgeClass(t) { return {daily:'badge-daily',weekly:'badge-weekly',monthly:'badge-monthly'}[t]||''; }
function hexAlpha(hex, a) {
  if (!hex || hex.length < 7) return `rgba(37,99,235,${a})`;
  const r=parseInt(hex.slice(1,3),16), g=parseInt(hex.slice(3,5),16), b=parseInt(hex.slice(5,7),16);
  return `rgba(${r},${g},${b},${a})`;
}
const STAGES = [
  {name:'Idea', pct:0, color:'#AAA89F'},
  {name:'Planning', pct:20, color:'#D97706'},
  {name:'In Progress', pct:50, color:'#2563EB'},
  {name:'Review', pct:80, color:'#7C3AED'},
  {name:'Done', pct:100, color:'#16A34A'},
];
function nearestStage(p) { return STAGES.reduce((a,b)=>Math.abs(b.pct-p)<Math.abs(a.pct-p)?b:a); }
function clamp(v) { return Math.min(100, Math.max(0, parseInt(v)||0)); }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SIDEBAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateSidebar() {
  document.getElementById('nb-all').textContent = D.length;
  document.getElementById('nb-daily').textContent = D.filter(p=>p.type==='daily').length;
  document.getElementById('nb-weekly').textContent = D.filter(p=>p.type==='weekly').length;
  document.getElementById('nb-monthly').textContent = D.filter(p=>p.type==='monthly').length;
  document.getElementById('nb-done').textContent = D.filter(p=>p.progress>=100).length;
  const over = D.filter(p=>p.due && p.progress<100 && new Date(p.due+'T00:00:00')<new Date()).length;
  document.getElementById('nb-overdue').textContent = over;
  const ob = document.getElementById('nb-overdue');
  ob.className = over > 0 ? 'nav-badge danger' : 'nav-badge';

  const list = document.getElementById('sidebar-project-list');
  list.innerHTML = D.map(p=>`
    <button class="project-list-item ${activeProject===p.id?'active':''}" onclick="goProject(${p.id})">
      <div class="pli-dot" style="background:${p.color||'#2563EB'}"></div>
      <span class="pli-name">${p.icon?p.icon+' ':''}${esc(p.name)}</span>
      ${p.tgEnabled?'<span class="pli-tg">âœˆï¸</span>':''}
      <span class="pli-pct">${p.progress}%</span>
    </button>`).join('') || `<div style="padding:8px 10px;font-size:12px;color:var(--sidebar-t3)">No projects yet.</div>`;

  document.querySelectorAll('.nav-item[id^="nav-"]').forEach(n=>n.classList.remove('active'));
  const navMap = {dashboard:'nav-dashboard',all:'nav-all',daily:'nav-daily',weekly:'nav-weekly',monthly:'nav-monthly',done:'nav-done',overdue:'nav-overdue'};
  if(view in navMap) document.getElementById(navMap[view])?.classList.add('active');

  // GitHub status
  const ghToken = localStorage.getItem('gh_token');
  const ghDot = document.getElementById('gh-status-dot');
  const ghLabel = document.getElementById('gh-status-label');
  if(ghToken) {
    if(ghDot) { ghDot.classList.remove('offline'); }
    if(ghLabel) { ghLabel.textContent = 'Gist Backup Active'; }
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goView(v) {
  view = v; activeProject = null;
  updateSidebar(); renderContent();
}
function goProject(id) {
  activeProject = id; view = 'project';
  updateSidebar(); renderContent();
}
function renderContent() {
  const el = document.getElementById('content');
  const tb = document.getElementById('tb-title');
  const crumb = document.getElementById('tb-crumb');
  const tabs = document.getElementById('tb-view-tabs');
  const acts = document.getElementById('tb-actions');
  tabs.innerHTML = ''; acts.innerHTML = '';

  if (view === 'dashboard') {
    tb.textContent = 'Dashboard'; crumb.textContent = 'Overview';
    el.innerHTML = renderDashboard();
  } else if (view === 'project' && activeProject) {
    const p = D.find(x=>x.id===activeProject);
    if (!p) { goView('dashboard'); return; }
    tb.textContent = 'Projects'; crumb.textContent = p.name;
    acts.innerHTML = `
      <button class="btn btn-ghost btn-sm" onclick="openAdd(${p.id})">âœ Edit</button>
      <button class="btn btn-danger btn-sm" onclick="openDel(${p.id})">ğŸ—‘</button>`;
    el.innerHTML = renderDetail(p);
  } else {
    const viewTitles = {all:'All Projects',daily:'Daily Tasks',weekly:'Weekly Projects',monthly:'Monthly Projects',done:'Completed',overdue:'Overdue'};
    tb.textContent = viewTitles[view]||'Projects';
    crumb.textContent = `${D.filter(p=>filterProjects(p,view)).length} projects`;
    el.innerHTML = renderList(view);
  }
}
function filterProjects(p, v) {
  if (v==='all') return true;
  if (v==='daily') return p.type==='daily';
  if (v==='weekly') return p.type==='weekly';
  if (v==='monthly') return p.type==='monthly';
  if (v==='done') return p.progress>=100;
  if (v==='overdue') return p.due && new Date(p.due+'T00:00:00')<new Date() && p.progress<100;
  return true;
}
function esc(s) {
  return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DASHBOARD
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboard() {
  const total = D.length;
  const done = D.filter(p=>p.progress>=100).length;
  const active = D.filter(p=>p.progress>0&&p.progress<100).length;
  const overdue = D.filter(p=>p.due&&new Date(p.due+'T00:00:00')<new Date()&&p.progress<100).length;
  const avgPct = total>0 ? Math.round(D.reduce((s,p)=>s+p.progress,0)/total) : 0;
  const now = new Date();
  const h = now.getHours();
  const greet = h<12?'Good morning,':h<18?'Good afternoon,':'Good evening,';
  const dayStr = now.toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric'});
  const recent = D.slice(0,6);
  const tgProjects = D.filter(p=>p.tgEnabled).length;

  return `
  <div class="au">
    <div class="dash-hero au">
      <div class="dash-greeting"><em>${greet}</em> <strong>Today We Build Something Special</strong></div>
      <div class="dash-sub">${dayStr} Â· ${total} project${total!==1?'s':''} tracked${tgProjects>0?` Â· âœˆï¸ ${tgProjects} with reminders`:''}</div>
      <div class="dash-kpis">
        <div class="kpi au au1">
          <div class="kpi-label">Total Projects</div>
          <div class="kpi-value" style="color:var(--blue)">${total}</div>
          <div class="kpi-delta">All time</div>
        </div>
        <div class="kpi au au2">
          <div class="kpi-label">Completed</div>
          <div class="kpi-value" style="color:var(--green)">${done}</div>
          <div class="kpi-delta"><b>${total>0?Math.round(done/total*100):0}%</b> rate</div>
        </div>
        <div class="kpi au au3">
          <div class="kpi-label">In Progress</div>
          <div class="kpi-value" style="color:var(--amber)">${active}</div>
          <div class="kpi-delta">Avg <b>${avgPct}%</b> done</div>
        </div>
        <div class="kpi au au4">
          <div class="kpi-label">Overdue</div>
          <div class="kpi-value" style="color:${overdue>0?'var(--red)':'var(--green)'}">${overdue}</div>
          <div class="kpi-delta">${overdue>0?'âš  Needs attention':'âœ“ All on track'}</div>
        </div>
      </div>
    </div>

    ${recent.length>0?`
    <div class="section-header au">
      <div class="section-title">Recent Projects</div>
      <button class="btn btn-ghost btn-sm" onclick="goView('all')">View all â†’</button>
    </div>
    <div class="project-cards">
      ${recent.map((p,i)=>`<div class="au" style="animation-delay:${i*0.05}s">${pcardHTML(p)}</div>`).join('')}
    </div>`:`
    <div class="empty">
      <div class="empty-ill">ğŸš€</div>
      <div class="empty-title">Ready to start?</div>
      <div class="empty-desc">Create your first project and start tracking your progress.</div>
      <button class="btn btn-primary" onclick="openAdd()">+ Create First Project</button>
    </div>`}

    ${activityLog.length>0?`
    <div class="section-header au" style="margin-top:28px">
      <div class="section-title">Recent Activity</div>
    </div>
    <div class="card au">
      ${activityLog.slice(0,8).map(a=>`
        <div class="activity-item">
          <div class="activity-dot" style="background:${a.color}"></div>
          <div class="activity-text">${a.msg}</div>
          <div class="activity-time">${relTime(a.time)}</div>
        </div>`).join('')}
    </div>`:''}
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  LIST VIEW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderList(v) {
  const list = D.filter(p=>filterProjects(p,v));
  if (list.length===0) return `
    <div class="empty">
      <div class="empty-ill">ğŸ“‚</div>
      <div class="empty-title">Nothing here</div>
      <div class="empty-desc">No projects in this category yet.</div>
      <button class="btn btn-primary" onclick="openAdd()">+ Create Project</button>
    </div>`;
  return `<div class="project-cards">${list.map((p,i)=>`<div class="au" style="animation-delay:${i*0.05}s">${pcardHTML(p)}</div>`).join('')}</div>`;
}

function pcardHTML(p) {
  const col = p.color||'#2563EB';
  const due = dueInfo(p.due);
  const pctCol = pctColor(p.progress);
  const doneTasks = (p.tasks||[]).filter(t=>t.done).length;
  const totalTasks = (p.tasks||[]).length;
  return `
  <div class="pcard" onclick="goProject(${p.id})">
    <div class="pcard-accent" style="background:${col}"></div>
    <div class="pcard-top">
      <div class="pcard-icon" style="background:${hexAlpha(col,0.12)}">${p.icon||'ğŸ“Œ'}</div>
      <div class="pcard-badges">
        <span class="pcard-badge ${typeBadgeClass(p.type)}">${typeLabel(p.type)}</span>
        ${p.tgEnabled?'<span class="pcard-badge badge-tg">âœˆï¸ Reminders</span>':''}
      </div>
    </div>
    <div class="pcard-name">${esc(p.name)}</div>
    <div class="pcard-desc">${p.desc?esc(p.desc):'<span style="color:var(--text3)">No description.</span>'}</div>
    <div class="pcard-progress-head">
      <span class="pcard-progress-label">PROGRESS</span>
      <span class="pcard-pct" style="color:${pctCol}">${p.progress}%</span>
    </div>
    <div class="prog-bar"><div class="prog-fill" style="width:${p.progress}%;background:${pctCol}"></div></div>
    <div class="pcard-footer">
      <div class="pcard-pill">
        <div class="pcard-pill-dot" style="background:${col}"></div>
        ${doneTasks}/${totalTasks} tasks
      </div>
      ${due?`<span class="due-chip ${due.cls}">ğŸ“… ${due.txt}</span>`:''}
      <span style="margin-left:auto;font-family:var(--mono);font-size:10px;color:var(--text3);padding:2px 8px;background:var(--bg2);border-radius:20px;border:1px solid var(--border)">${p.priority||'med'}</span>
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROJECT DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDetail(p) {
  const col = p.color||'#2563EB';
  const pctCol = pctColor(p.progress);
  const due = dueInfo(p.due);
  const doneTasks = (p.tasks||[]).filter(t=>t.done).length;
  const totalTasks = (p.tasks||[]).length;
  const stage = nearestStage(p.progress);
  const tgEnabled = p.tgEnabled||false;
  const tgToken = localStorage.getItem('tg_token');

  return `
  <div class="au">
    <div class="detail-header">
      <div class="detail-header-accent" style="background:${col}"></div>
      <div class="detail-top">
        <div class="detail-icon" style="background:${hexAlpha(col,0.12)}">${p.icon||'ğŸ“Œ'}</div>
        <div style="flex:1;min-width:0">
          <div class="detail-title">${esc(p.name)}</div>
          <div class="detail-desc-text">${p.desc?esc(p.desc):'<span style="color:var(--text3)">No description.</span>'}</div>
        </div>
        <div class="detail-actions">
          ${due?`<span class="due-chip ${due.cls}">ğŸ“… ${due.txt}</span>`:''}
          <span class="pcard-badge ${typeBadgeClass(p.type)}" style="font-size:11px;padding:4px 10px">${typeLabel(p.type)}</span>
        </div>
      </div>

      <div class="detail-kpis au au1">
        <div class="dkpi">
          <div class="dkpi-label">Progress</div>
          <div class="dkpi-val" style="color:${pctCol}">${p.progress}%</div>
          <div class="dkpi-sub">${stage.name}</div>
        </div>
        <div class="dkpi">
          <div class="dkpi-label">Tasks</div>
          <div class="dkpi-val">${doneTasks}/${totalTasks}</div>
          <div class="dkpi-sub">${totalTasks>0?Math.round(doneTasks/totalTasks*100):0}% done</div>
        </div>
        <div class="dkpi">
          <div class="dkpi-label">Priority</div>
          <div class="dkpi-val" style="font-size:15px;padding-top:3px;color:${p.priority==='high'?'var(--red)':p.priority==='low'?'var(--green)':'var(--amber)'}">${(p.priority||'med').charAt(0).toUpperCase()+(p.priority||'med').slice(1)}</div>
          <div class="dkpi-sub">${p.type}</div>
        </div>
        <div class="dkpi">
          <div class="dkpi-label">Created</div>
          <div class="dkpi-val" style="font-size:15px;padding-top:3px">${new Date(p.created).toLocaleDateString('en-US',{month:'short',day:'numeric'})}</div>
          <div class="dkpi-sub">${relTime(p.created)}</div>
        </div>
      </div>

      <div class="au au2">
        <div class="big-prog-head">
          <span class="big-prog-label">Overall Progress</span>
          <span class="big-prog-pct" id="ppct-disp" style="color:${pctCol}">${p.progress}%</span>
        </div>
        <div class="big-prog-bar">
          <div class="big-prog-fill" id="ppct-bar" style="width:${p.progress}%;background:${pctCol}"></div>
        </div>
        <div class="slider-row">
          <input type="range" class="prog-slider" id="ppct-sl" min="0" max="100" value="${p.progress}"
            oninput="livePct(this.value,${p.id})" onchange="savePct(${p.id})">
          <div class="pct-box">
            <input class="pct-inp" id="ppct-num" type="number" min="0" max="100" value="${p.progress}"
              oninput="livePctNum(this.value,${p.id})">
            <span class="pct-sym">%</span>
          </div>
        </div>
      </div>
    </div>

    <div class="detail-grid">
      <!-- Tasks -->
      <div class="card au au1">
        <div class="card-head">
          <div class="card-title">Tasks & Milestones</div>
          <div class="card-meta">${doneTasks}/${totalTasks} done</div>
        </div>
        <div id="task-list-${p.id}">
          ${totalTasks===0?`<div style="padding:20px;text-align:center;font-size:13px;color:var(--text3)">No tasks yet. Add one below!</div>`:''}
          ${(p.tasks||[]).map((t,i)=>`
            <div class="task-item">
              <div class="task-check ${t.done?'done':''}" onclick="toggleTask(${p.id},${i})"></div>
              <span class="task-name-text ${t.done?'done':''}">${esc(t.name)}</span>
              <button class="task-del" onclick="delTask(${p.id},${i})">âœ•</button>
            </div>`).join('')}
        </div>
        <div class="task-add-row">
          <input class="task-add-inp" id="tadd-${p.id}" placeholder="Add task, press Enterâ€¦"
            onkeydown="if(event.key==='Enter'){event.preventDefault();addTask(${p.id})}">
          <button class="btn btn-ghost btn-sm" onclick="addTask(${p.id})">Add</button>
        </div>
      </div>

      <!-- Stage -->
      <div class="card au au2">
        <div class="card-head">
          <div class="card-title">Stage</div>
          <div class="card-meta">Sets base %</div>
        </div>
        <div class="stage-opts">
          ${STAGES.map(s=>`
            <div class="stage-opt ${p.progress===s.pct?'active':''}"
              onclick="setStage(${p.id},${s.pct})">
              <div class="stage-dot" style="background:${s.color}"></div>
              <div class="stage-name">${s.name}</div>
              <div class="stage-pct-label">${s.pct}%</div>
            </div>`).join('')}
        </div>
      </div>

      <!-- Notes -->
      <div class="card au au3">
        <div class="card-head">
          <div class="card-title">Notes</div>
          <div class="card-meta">Auto-saved</div>
        </div>
        <textarea class="notes-ta" placeholder="Write anything â€” ideas, blockers, links, context..."
          id="notes-${p.id}" onblur="saveNotes(${p.id})">${esc(p.notes||'')}</textarea>
      </div>

      <!-- Priority -->
      <div class="card au au4">
        <div class="card-head">
          <div class="card-title">Priority</div>
          <div class="card-meta">Current: ${p.priority||'med'}</div>
        </div>
        <div class="pri-grid">
          <button class="pri-btn ph ${p.priority==='high'?'on':''}" onclick="setPri(${p.id},'high')">ğŸ”´ High</button>
          <button class="pri-btn pm ${p.priority==='med'||!p.priority?'on':''}" onclick="setPri(${p.id},'med')">ğŸŸ¡ Medium</button>
          <button class="pri-btn pl ${p.priority==='low'?'on':''}" onclick="setPri(${p.id},'low')">ğŸŸ¢ Low</button>
          <button class="pri-btn pn ${p.priority==='none'?'on':''}" onclick="setPri(${p.id},'none')">âšª None</button>
        </div>
      </div>

      <!-- Telegram Card -->
      <div class="card au au1 full-width">
        <div class="card-head">
          <div class="card-title">âœˆï¸ Telegram Reminders</div>
          <div class="card-meta">${tgEnabled?`ğŸŸ¢ Active Â· ${p.tgTime||'09:00'}`:tgToken?'âšª Disabled':'âš™ï¸ Configure in Settings'}</div>
        </div>
        <div class="tg-card">
          ${!tgToken?`<div class="tg-info-box">
            Configure your Telegram bot first in <button onclick="openSettings('tab-telegram')" class="btn btn-telegram btn-sm" style="margin-left:6px">âš™ï¸ Settings â†’ Telegram</button>
          </div>`:`
          <div class="tg-toggle-row">
            <div class="tg-toggle-label">
              <div class="tg-toggle-title">Daily Reminder</div>
              <div class="tg-toggle-desc">Get notified every day about pending tasks in this project</div>
            </div>
            <button class="tg-switch ${tgEnabled?'on':''}" onclick="toggleProjectTg(${p.id})"></button>
          </div>
          ${tgEnabled?`
          <div class="tg-fields" id="tg-detail-fields-${p.id}">
            <div class="field">
              <div class="tg-field-label">Reminder Time</div>
              <input class="fi" type="time" id="tg-time-${p.id}" value="${p.tgTime||'09:00'}"
                onchange="saveTgTime(${p.id},this.value)" style="max-width:140px" />
            </div>
            <div class="field">
              <div class="tg-field-label">Custom Message (optional)</div>
              <input class="fi" id="tg-msg-${p.id}" value="${esc(p.tgMsg||'')}"
                placeholder="e.g. Time to check on this project!"
                onblur="saveTgMsg(${p.id},this.value)" />
            </div>
            <div style="display:flex;gap:8px;align-items:center">
              <button class="btn btn-telegram btn-sm" onclick="testProjectNotification(${p.id})">ğŸ“¨ Send Test</button>
              <span id="tg-detail-status-${p.id}" class="tg-status"></span>
            </div>
          </div>`:''}
          `}
        </div>
      </div>
    </div>
  </div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROGRESS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function livePct(val, id) {
  val = clamp(val);
  const c = pctColor(val);
  const disp = document.getElementById('ppct-disp');
  const bar = document.getElementById('ppct-bar');
  const num = document.getElementById('ppct-num');
  if(disp) { disp.textContent = val+'%'; disp.style.color = c; }
  if(bar) { bar.style.width = val+'%'; bar.style.background = c; }
  if(num) num.value = val;
  const p = D.find(x=>x.id===id);
  if(p) { p.progress=val; save(); updateSidebar(); }
}
function livePctNum(val, id) {
  val = clamp(val);
  const sl = document.getElementById('ppct-sl');
  if(sl) sl.value = val;
  livePct(val, id);
}
function savePct(id) { const p=D.find(x=>x.id===id); if(p){ logActivity(`Progress updated to <strong>${p.progress}%</strong> on "${esc(p.name)}"`,p.color); updateSidebar(); }}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TASKS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function addTask(id) {
  const inp = document.getElementById(`tadd-${id}`);
  if(!inp) return;
  const name = inp.value.trim();
  if (!name) return;
  const p = D.find(x=>x.id===id);
  if (!p) return;
  p.tasks = p.tasks||[];
  p.tasks.push({name, done:false});
  autoProgress(p);
  save(); inp.value='';
  logActivity(`Added task <strong>"${esc(name)}"</strong> to "${esc(p.name)}"`, p.color);
  goProject(id);
  toast('Task added', '#16A34A');
}
function toggleTask(id, i) {
  const p = D.find(x=>x.id===id);
  if(!p||!p.tasks||!p.tasks[i]) return;
  p.tasks[i].done = !p.tasks[i].done;
  autoProgress(p); save(); updateSidebar();
  logActivity(`${p.tasks[i].done?'Completed':'Unchecked'} task <strong>"${esc(p.tasks[i].name)}"</strong>`, p.color);
  goProject(id);
}
function delTask(id, i) {
  const p = D.find(x=>x.id===id);
  if(!p||!p.tasks||!p.tasks[i]) return;
  const name = p.tasks[i].name;
  p.tasks.splice(i,1);
  autoProgress(p); save(); updateSidebar();
  logActivity(`Deleted task <strong>"${esc(name)}"</strong> from "${esc(p.name)}"`, '#DC2626');
  goProject(id);
}
function autoProgress(p) {
  if(!p.tasks||p.tasks.length===0) return;
  p.progress = Math.round(p.tasks.filter(t=>t.done).length / p.tasks.length * 100);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STAGE, NOTES, PRIORITY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function setStage(id, pct) {
  const p=D.find(x=>x.id===id); if(!p) return;
  p.progress=pct; save(); updateSidebar();
  logActivity(`Stage set to <strong>${nearestStage(pct).name}</strong> on "${esc(p.name)}"`,p.color);
  goProject(id); toast('Stage updated','#16A34A');
}
function saveNotes(id) {
  const el = document.getElementById(`notes-${id}`);
  const p=D.find(x=>x.id===id); if(!p||!el) return;
  p.notes=el.value; save();
  toast('Notes saved','#16A34A');
}
function setPri(id, val) {
  const p=D.find(x=>x.id===id); if(!p) return;
  p.priority=val; save();
  logActivity(`Priority set to <strong>${val}</strong> on "${esc(p.name)}"`,p.color);
  goProject(id);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TELEGRAM
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleProjectTg(id) {
  const p=D.find(x=>x.id===id); if(!p) return;
  p.tgEnabled = !p.tgEnabled;
  if(!p.tgTime) p.tgTime = '09:00';
  save(); updateSidebar();
  logActivity(`Telegram reminders ${p.tgEnabled?'enabled':'disabled'} for "${esc(p.name)}"`, '#229ED9');
  goProject(id);
  toast(p.tgEnabled?'Telegram reminders enabled âœˆï¸':'Reminders disabled', p.tgEnabled?'#229ED9':'#888');
}
function saveTgTime(id, val) {
  const p=D.find(x=>x.id===id); if(!p) return;
  p.tgTime=val; save();
  toast('Reminder time saved','#229ED9');
}
function saveTgMsg(id, val) {
  const p=D.find(x=>x.id===id); if(!p) return;
  p.tgMsg=val; save();
}
async function testProjectNotification(id) {
  const p=D.find(x=>x.id===id); if(!p) return;
  const statusEl = document.getElementById(`tg-detail-status-${id}`);
  if(statusEl) { statusEl.textContent='Sending...'; statusEl.className='tg-status'; }
  const pendingTasks = (p.tasks||[]).filter(t=>!t.done);
  const msg = `${p.tgMsg||`ğŸ“‹ Daily reminder for "${p.name}"`}\n\nğŸ“Š Progress: ${p.progress}%\nâœ… Tasks: ${(p.tasks||[]).filter(t=>t.done).length}/${(p.tasks||[]).length} done${pendingTasks.length>0?'\n\nâ³ Pending:\n'+pendingTasks.slice(0,5).map(t=>`â€¢ ${t.name}`).join('\n'):''}`;
  const ok = await sendTelegram(msg);
  if(statusEl) { statusEl.textContent=ok?'âœ… Sent!':'âŒ Failed â€“ check settings'; statusEl.className=`tg-status ${ok?'ok':'err'}`; }
}
async function sendTelegram(text) {
  const token = localStorage.getItem('tg_token');
  const chatId = localStorage.getItem('tg_chatid');
  if(!token||!chatId) return false;
  try {
    const res = await fetch(`https://api.telegram.org/bot${token}/sendMessage`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({chat_id:chatId, text, parse_mode:'HTML'})
    });
    const data = await res.json();
    return data.ok === true;
  } catch(e) { return false; }
}
function saveTelegramSettings() {
  const token = document.getElementById('tg-token')?.value.trim();
  const chatId = document.getElementById('tg-chatid')?.value.trim();
  if(!token||!chatId) { toast('Enter both token and chat ID','#DC2626'); return; }
  localStorage.setItem('tg_token', token);
  localStorage.setItem('tg_chatid', chatId);
  toast('Telegram settings saved','#229ED9');
  updateTgProjectList();
}
async function testTelegram() {
  const token = document.getElementById('tg-token')?.value.trim();
  const chatId = document.getElementById('tg-chatid')?.value.trim();
  if(!token||!chatId) { toast('Enter both token and chat ID first','#DC2626'); return; }
  localStorage.setItem('tg_token', token);
  localStorage.setItem('tg_chatid', chatId);
  const statusEl = document.getElementById('tg-test-status');
  if(statusEl) { statusEl.textContent='Sending...'; statusEl.className='tg-status'; }
  const ok = await sendTelegram(`ğŸ‰ <b>Projects Center connected!</b>\n\nYour Telegram notifications are working. You'll receive daily reminders for projects where reminders are enabled.\n\nProjects tracked: ${D.length}`);
  if(statusEl) { statusEl.textContent=ok?'âœ… Message sent!':'âŒ Failed â€” check your token and chat ID'; statusEl.className=`tg-status ${ok?'ok':'err'}`; }
  if(ok) toast('Telegram connected! âœˆï¸', '#229ED9');
}
function updateTgProjectList() {
  const el = document.getElementById('tg-project-list');
  if(!el) return;
  const tgPs = D.filter(p=>p.tgEnabled);
  if(tgPs.length===0) { el.textContent='No reminders configured yet.'; return; }
  el.innerHTML = tgPs.map(p=>`
    <div style="display:flex;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--border)">
      <div style="width:8px;height:8px;border-radius:50%;background:${p.color||'#229ED9'};flex-shrink:0"></div>
      <span style="flex:1">${esc(p.name)}</span>
      <span style="font-family:var(--mono);font-size:11px;color:var(--text3)">${p.tgTime||'09:00'}</span>
    </div>`).join('');
}

// Daily reminder scheduler (runs in-browser; for real background notifications use a server)
function scheduleDailyReminders() {
  const now = new Date();
  D.filter(p=>p.tgEnabled&&p.tgTime).forEach(p=>{
    const [h,m] = (p.tgTime||'09:00').split(':').map(Number);
    const target = new Date(now); target.setHours(h,m,0,0);
    if(target<=now) target.setDate(target.getDate()+1);
    const ms = target-now;
    // Store timer so we know it's scheduled
    const key = `tg_scheduled_${p.id}`;
    const lastSent = parseInt(localStorage.getItem(key)||'0');
    const todayMidnight = new Date(); todayMidnight.setHours(0,0,0,0);
    // Send if not already sent today
    if(lastSent < todayMidnight.getTime() && ms < 60000) {
      const pendingTasks = (p.tasks||[]).filter(t=>!t.done);
      const msg = `${p.tgMsg||`ğŸ“‹ Daily reminder: "${p.name}"`}\n\nğŸ“Š Progress: ${p.progress}%\nâœ… Tasks: ${(p.tasks||[]).filter(t=>t.done).length}/${(p.tasks||[]).length} done${pendingTasks.length>0?'\n\nâ³ Pending:\n'+pendingTasks.slice(0,5).map(t=>`â€¢ ${t.name}`).join('\n'):''}`;
      sendTelegram(msg).then(ok=>{
        if(ok) localStorage.setItem(key, Date.now().toString());
      });
    }
    setTimeout(()=>scheduleDailyReminders(), ms < 60000 ? 60000 : ms);
  });
}
// Start scheduler
setTimeout(scheduleDailyReminders, 5000);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ADD / EDIT MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openAdd(id) {
  editingId = id||null;
  const p = id ? D.find(x=>x.id===id) : null;
  newType = p?.type||'daily';
  newColor = p?.color||'#2563EB';
  modalTgEnabled = p?.tgEnabled||false;

  document.getElementById('modal-title-txt').textContent = p ? 'Edit Project' : 'New Project';
  document.getElementById('f-name').value = p?.name||'';
  document.getElementById('f-desc').value = p?.desc||'';
  document.getElementById('f-due').value = p?.due||'';
  document.getElementById('f-pri').value = p?.priority||'med';
  document.getElementById('f-icon').value = p?.icon||'';
  document.getElementById('f-sl').value = p?.progress||0;
  document.getElementById('f-pn').value = p?.progress||0;

  // TG fields
  document.getElementById('tg-f-time').value = p?.tgTime||'09:00';
  document.getElementById('tg-f-msg').value = p?.tgMsg||'';
  updateModalTgUI();

  // Show global warning if no token
  const tgToken = localStorage.getItem('tg_token');
  const warn = document.getElementById('tg-global-warning');
  if(warn) warn.style.display = (!tgToken&&modalTgEnabled)?'block':'none';

  document.querySelectorAll('.tc').forEach(c=>c.classList.remove('on'));
  document.querySelector(`.t${newType.charAt(0)}`)?.classList.add('on');
  document.querySelectorAll('.sw').forEach(c=>c.classList.toggle('on', c.dataset.c===newColor));

  document.getElementById('addOverlay').classList.add('open');
  setTimeout(()=>document.getElementById('f-name').focus(), 260);
}
function closeAdd() { document.getElementById('addOverlay').classList.remove('open'); }

function toggleModalTg() {
  modalTgEnabled = !modalTgEnabled;
  const tgToken = localStorage.getItem('tg_token');
  const warn = document.getElementById('tg-global-warning');
  if(warn) warn.style.display = (!tgToken&&modalTgEnabled)?'block':'none';
  updateModalTgUI();
}
function updateModalTgUI() {
  const sw = document.getElementById('tg-f-switch');
  const lbl = document.getElementById('tg-f-label');
  const fields = document.getElementById('tg-f-fields');
  if(sw) sw.className = `tg-switch${modalTgEnabled?' on':''}`;
  if(lbl) lbl.textContent = modalTgEnabled?'On':'Off';
  if(fields) fields.style.display = modalTgEnabled?'flex':'none';
}

function selType(t, el) {
  newType = t;
  document.querySelectorAll('.tc').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');
}
function selColor(el) {
  newColor = el.dataset.c;
  document.querySelectorAll('.sw').forEach(c=>c.classList.remove('on'));
  el.classList.add('on');
}
function saveProject() {
  const name = document.getElementById('f-name').value.trim();
  if (!name) { toast('Please enter a project name','#DC2626'); document.getElementById('f-name').focus(); return; }
  const pct = clamp(document.getElementById('f-pn').value);
  const tgTime = document.getElementById('tg-f-time').value;
  const tgMsg = document.getElementById('tg-f-msg').value.trim();

  if (editingId) {
    const p=D.find(x=>x.id===editingId);
    if(p){
      p.name=name; p.desc=document.getElementById('f-desc').value.trim();
      p.type=newType; p.due=document.getElementById('f-due').value;
      p.priority=document.getElementById('f-pri').value;
      p.color=newColor; p.icon=document.getElementById('f-icon').value.trim()||'ğŸ“Œ';
      p.progress=pct;
      p.tgEnabled=modalTgEnabled; p.tgTime=tgTime; p.tgMsg=tgMsg;
    }
    save(); closeAdd(); updateSidebar();
    logActivity(`Updated project <strong>"${esc(name)}"</strong>`, newColor);
    if(activeProject===editingId) goProject(editingId);
    toast('Project updated','#16A34A');
  } else {
    const p = {
      id: Date.now(), name,
      desc: document.getElementById('f-desc').value.trim(),
      type: newType, due: document.getElementById('f-due').value,
      priority: document.getElementById('f-pri').value,
      color: newColor, icon: document.getElementById('f-icon').value.trim()||'ğŸ“Œ',
      progress: pct, tasks:[], notes:'', created: Date.now(),
      tgEnabled: modalTgEnabled, tgTime, tgMsg
    };
    D.unshift(p); save(); closeAdd(); updateSidebar();
    logActivity(`Created project <strong>"${esc(name)}"</strong>`, newColor);
    goProject(p.id);
    toast('Project created ğŸ‰','#16A34A');
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DELETE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openDel(id) {
  deleteId=id;
  const p=D.find(x=>x.id===id);
  document.getElementById('del-desc').textContent=`"${p?.name}" and all its data will be permanently removed.`;
  document.getElementById('delOverlay').classList.add('open');
}
function closeDel() { document.getElementById('delOverlay').classList.remove('open'); deleteId=null; }
function doDelete() {
  const p=D.find(x=>x.id===deleteId);
  const name=p?.name||'project';
  D=D.filter(x=>x.id!==deleteId);
  save(); closeDel();
  logActivity(`Deleted project <strong>"${esc(name)}"</strong>`,'#DC2626');
  if(activeProject===deleteId) activeProject=null;
  goView('dashboard');
  toast('Project deleted','#DC2626');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS MODAL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openSettings(tab) {
  // Load saved values
  document.getElementById('tg-token').value = localStorage.getItem('tg_token')||'';
  document.getElementById('tg-chatid').value = localStorage.getItem('tg_chatid')||'';
  document.getElementById('gh-token').value = localStorage.getItem('gh_token')||'';
  document.getElementById('gh-gist-id').value = localStorage.getItem('gh_gist_id')||'';
  updateTgProjectList();
  updateStorageInfo();
  if(tab) {
    document.querySelectorAll('.stab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.stab-pane').forEach(p=>p.classList.remove('active'));
    document.getElementById(tab)?.classList.add('active');
    // Find and activate the corresponding tab button
    document.querySelectorAll('.stab').forEach(t=>{
      if(t.getAttribute('onclick')?.includes(tab)) t.classList.add('active');
    });
  }
  document.getElementById('settingsOverlay').classList.add('open');
}
function closeSettings() { document.getElementById('settingsOverlay').classList.remove('open'); }
function switchTab(id, el) {
  document.querySelectorAll('.stab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.stab-pane').forEach(p=>p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById(id)?.classList.add('active');
  if(id==='tab-data') updateStorageInfo();
  if(id==='tab-telegram') updateTgProjectList();
}
function updateStorageInfo() {
  const el = document.getElementById('storage-info');
  if(!el) return;
  const dataSize = new Blob([localStorage.getItem('pc_v4')||'']).size;
  const actSize = new Blob([localStorage.getItem('pc_activity')||'']).size;
  const total = dataSize + actSize;
  el.innerHTML = `
    Projects: <strong>${D.length}</strong> Â· 
    Tasks: <strong>${D.reduce((s,p)=>s+(p.tasks||[]).length,0)}</strong> Â· 
    Storage used: <strong>${(total/1024).toFixed(1)} KB</strong>
    <br><span style="color:var(--text3);margin-top:4px;display:block">Browser localStorage (~5MB limit). Export regularly as backup.</span>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  EXPORT / IMPORT / CLEAR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function exportData() {
  const data = {
    version: 4,
    exported: new Date().toISOString(),
    projects: D,
    activity: activityLog,
    settings: {
      tg_token: localStorage.getItem('tg_token'),
      tg_chatid: localStorage.getItem('tg_chatid')
    }
  };
  const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url; a.download=`projects-center-backup-${new Date().toISOString().slice(0,10)}.json`;
  a.click(); URL.revokeObjectURL(url);
  toast('Data exported!','#16A34A');
}
function importData(e) {
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    try {
      const data = JSON.parse(ev.target.result);
      if(!data.projects) { toast('Invalid backup file','#DC2626'); return; }
      if(!confirm(`Import ${data.projects.length} projects? This will REPLACE your current data.`)) return;
      D = data.projects;
      activityLog = data.activity||[];
      if(data.settings?.tg_token) localStorage.setItem('tg_token', data.settings.tg_token);
      if(data.settings?.tg_chatid) localStorage.setItem('tg_chatid', data.settings.tg_chatid);
      save(); updateSidebar(); goView('dashboard');
      toast(`Imported ${D.length} projects!`,'#16A34A');
      closeSettings();
    } catch(err) { toast('Failed to parse file','#DC2626'); }
  };
  reader.readAsText(file);
  e.target.value='';
}
function clearAllData() {
  if(!confirm('Delete ALL projects and activity? This cannot be undone.')) return;
  D=[]; activityLog=[];
  save(); updateSidebar(); goView('dashboard');
  toast('All data cleared','#DC2626');
  closeSettings();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GITHUB GIST SYNC
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function saveToGist() {
  const token = document.getElementById('gh-token').value.trim();
  const gistId = document.getElementById('gh-gist-id').value.trim();
  const statusEl = document.getElementById('gh-status');
  if(!token) { toast('Enter your GitHub token first','#DC2626'); return; }
  if(statusEl) statusEl.textContent='Saving...';
  const data = JSON.stringify({version:4, exported:new Date().toISOString(), projects:D, activity:activityLog}, null, 2);
  try {
    const method = gistId ? 'PATCH' : 'POST';
    const url = gistId ? `https://api.github.com/gists/${gistId}` : 'https://api.github.com/gists';
    const res = await fetch(url, {
      method,
      headers: {'Authorization':`token ${token}`,'Content-Type':'application/json'},
      body: JSON.stringify({
        description:'Projects Center Backup',
        public: false,
        files: {'projects-center-backup.json':{content:data}}
      })
    });
    const resp = await res.json();
    if(resp.id) {
      localStorage.setItem('gh_token', token);
      localStorage.setItem('gh_gist_id', resp.id);
      document.getElementById('gh-gist-id').value = resp.id;
      if(statusEl) statusEl.textContent='âœ… Saved!';
      updateSidebar(); toast('Backup saved to GitHub Gist!','#16A34A');
    } else { if(statusEl) statusEl.textContent='âŒ Failed'; toast('Gist save failed','#DC2626'); }
  } catch(e) { if(statusEl) statusEl.textContent='âŒ Error'; toast('Network error','#DC2626'); }
}
async function loadFromGist() {
  const token = document.getElementById('gh-token').value.trim();
  const gistId = document.getElementById('gh-gist-id').value.trim();
  const statusEl = document.getElementById('gh-status');
  if(!token||!gistId) { toast('Enter token and Gist ID','#DC2626'); return; }
  if(statusEl) statusEl.textContent='Loading...';
  try {
    const res = await fetch(`https://api.github.com/gists/${gistId}`, {
      headers: {'Authorization':`token ${token}`}
    });
    const resp = await res.json();
    const content = resp.files?.['projects-center-backup.json']?.content;
    if(!content) { if(statusEl) statusEl.textContent='âŒ Not found'; return; }
    const data = JSON.parse(content);
    if(!confirm(`Restore ${data.projects?.length||0} projects from Gist? This will replace your current data.`)) return;
    D = data.projects||[];
    activityLog = data.activity||[];
    localStorage.setItem('gh_token', token);
    localStorage.setItem('gh_gist_id', gistId);
    save(); updateSidebar(); goView('dashboard');
    if(statusEl) statusEl.textContent='âœ… Restored!';
    toast('Data restored from Gist!','#16A34A');
    closeSettings();
  } catch(e) { if(statusEl) statusEl.textContent='âŒ Error'; toast('Restore failed','#DC2626'); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TOAST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toast(msg, color='#2563EB') {
  const w=document.getElementById('toastWrap');
  const el=document.createElement('div');
  el.className='toast';
  el.innerHTML=`<div class="toast-dot" style="background:${color}"></div>${msg}`;
  w.appendChild(el);
  requestAnimationFrame(()=>{ requestAnimationFrame(()=>el.classList.add('show')); });
  setTimeout(()=>{el.classList.remove('show');setTimeout(()=>{if(el.parentNode)el.remove();},400);},2800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  KEYBOARD SHORTCUTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('keydown', e=>{
  if(e.key==='Escape'){ closeAdd(); closeDel(); closeSettings(); }
  if((e.metaKey||e.ctrlKey)&&e.key==='k'){ e.preventDefault(); openAdd(); }
  if((e.metaKey||e.ctrlKey)&&e.key==='d'){ e.preventDefault(); goView('dashboard'); }
  if((e.metaKey||e.ctrlKey)&&e.key===','){ e.preventDefault(); openSettings('tab-telegram'); }
});

// Close modals on backdrop
document.getElementById('addOverlay').addEventListener('click',e=>{if(e.target===e.currentTarget)closeAdd();});
document.getElementById('delOverlay').addEventListener('click',e=>{if(e.target===e.currentTarget)closeDel();});
document.getElementById('settingsOverlay').addEventListener('click',e=>{if(e.target===e.currentTarget)closeSettings();});

// Copy code snippet helper
function copyCode(text) {
  navigator.clipboard.writeText(text).then(()=>toast('Copied!','#16A34A'));
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MIGRATE OLD DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function migrateOldData() {
  const old = localStorage.getItem('pc_v3');
  if(old && !localStorage.getItem('pc_v4')) {
    try {
      const oldData = JSON.parse(old);
      if(oldData.length > 0) {
        localStorage.setItem('pc_v4', old);
        toast(`Migrated ${oldData.length} projects from previous version!`, '#16A34A');
      }
    } catch(e) {}
  }
}
migrateOldData();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
updateSidebar();
renderContent();
</script>
</body>
</html>
